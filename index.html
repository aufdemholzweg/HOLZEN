<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Holz-Quartett: Gamifizierung in der Berufsbildung</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* DESIGN DEFINITIONEN */
        body { font-family: 'Inter', sans-serif; background-color: #fdfbf7; touch-action: manipulation; overflow-x: hidden; min-height: 100dvh; }
        .perspective-1000 { perspective: 1000px; }
        .card-3d { transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-flipped { transform: rotateY(180deg); }
        .card-front, .card-back { backface-visibility: hidden; position: absolute; width: 100%; height: 100%; top: 0; left: 0; border-radius: 1rem; overflow: hidden; box-sizing: border-box; }
        .card-back { 
            transform: rotateY(180deg);
            background-color: #2c3e50;
            background-image: url('https://github.com/aufdemholzweg/holzquartett/blob/326bdfd40ff4d97de5c70dc584fe767aba056135/images/background_card.jpg?raw=true'); 
            background-size: cover; 
            background-position: center; 
            border: 4px solid white;
        }
        .card-front-bg { background-color: #fffbeb; background-image: linear-gradient(to bottom right, #fffbeb, #fef3c7); }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        
        /* Status-Ball Animation */
        .animate-pulse-glow { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); transform: translate(-50%, -50%) scale(1); } 50% { box-shadow: 0 0 15px 5px rgba(34, 197, 94, 0.4); transform: translate(-50%, -50%) scale(1.1); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); transform: translate(-50%, -50%) scale(1); } }
        
        /* Pop-In Animation f√ºr Fenster */
        .animate-pop-in { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes pop-in { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        /* Bounce Animation f√ºr Gleichstand */
        .animate-bounce-slam { animation: bounce-slam 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes bounce-slam { 
            0% { transform: scale(0); opacity: 0; } 
            60% { transform: scale(1.1); opacity: 1; } 
            100% { transform: scale(1); opacity: 1; } 
        }

        /* KLOTZI JUBEL ANIMATION (Runde gewonnen) */
        @keyframes slide-up-bounce {
            0% { transform: translateY(100%) rotate(10deg); opacity: 0; }
            60% { transform: translateY(-20px) rotate(-5deg); opacity: 1; }
            80% { transform: translateY(10px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0deg); opacity: 1; }
        }
        .animate-klotzi-popup { animation: slide-up-bounce 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        /* NEU: RUN FLAMMEN ANIMATION */
        @keyframes flame-in {
            0% { transform: scale(0) rotate(-20deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .animate-run-flame { animation: flame-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        .opponent-back-name { position: absolute; top: 15%; width: 100%; text-align: center; color: rgba(255,255,255,0.95); font-weight: 700; font-size: 1.1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); pointer-events: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .dimmer { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .attr-box { background-color: #fff7ed; border: 1px solid #fbbf24; transition: all 0.2s; }
        .attr-box.flash-active { background-color: #f97316 !important; border-color: #ea580c !important; color: white !important; }
        .attr-box.flash-active span { color: white !important; }
        .attr-box.highlight-compare { background-color: #e5e7eb !important; border-color: #9ca3af !important; color: #111827 !important; }
        .attr-box.highlight-compare span { color: #000000 !important; }
        
        .toggle-checkbox:checked { right: 0; border-color: #68D391; }
        .toggle-checkbox:checked + .toggle-label { background-color: #68D391; }
        .attr-toggle-btn { transition: all 0.2s; border: 2px solid transparent; }
        .attr-toggle-btn.selected { background-color: #fef3c7; border-color: #f59e0b; color: #92400e; }
        .attr-toggle-btn.selected .w-6 { border-color: #f59e0b; background-color: #f59e0b; color: white; }
        .attr-toggle-btn:not(.selected) { background-color: #f3f4f6; color: #9ca3af; border-color: transparent; }

        /* ANIMATIONEN F√úR DEN BALKEN & PUNKT */
        @keyframes pulse-dot-anim { 
            0%, 100% { transform: translate(50%, -50%) scale(1); } 
            50% { transform: translate(50%, -50%) scale(1.4); } 
        }
        .animate-pulse-dot { animation: pulse-dot-anim 1s infinite ease-in-out; }

        @keyframes chargeWidth { from { width: 0%; } to { width: 100%; } }
        .animate-charge { animation: chargeWidth 1.5s linear forwards; }
        
        @keyframes shrinkWidth { from { width: 100%; } to { width: 0%; } }
        .animate-shrink { animation: shrinkWidth 10s linear forwards; }
    </style>
</head>
<body class="flex flex-col relative text-gray-800">

<header id="mainHeader" class="fixed top-0 left-0 w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md z-[120]">
    <div class="max-w-[600px] mx-auto px-4 py-3 relative flex justify-between items-center">
        
        <a id="navButton" href="https://aufdemholzweg.github.io/Splashscreen-Holztechnik/" class="relative z-[130] w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center text-white shadow-md border-2 border-white/20 hover:scale-105 transition-transform" aria-label="Navigation">
        </a>
        
        <h1 class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-lg sm:text-2xl font-black tracking-wider uppercase drop-shadow-sm whitespace-nowrap pointer-events-none">üå≤ HOLZEN! üå≤</h1>
        
        <button id="ruleButton" onclick="window.showGameInfo()" class="relative z-[130] w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center text-white shadow-md border-2 border-white/20 hover:scale-105 transition-transform active:scale-90" aria-label="Spielregeln">
             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
             </svg>
        </button>
    </div>
</header>

<div id="runOverlay" class="fixed inset-0 z-[200] flex items-center justify-center pointer-events-none hidden">
    <div class="flex flex-col items-center animate-run-flame">
        <span class="text-8xl filter drop-shadow-2xl">üî•</span>
        <h2 class="text-4xl font-black text-orange-600 bg-white/95 px-6 py-2 rounded-full shadow-2xl mt-4 border-4 border-orange-500 text-center uppercase tracking-tight">DU HAST EINEN RUN!</h2>
    </div>
</div>

<div id="gameContainer" class="hidden flex-grow flex flex-col items-center w-full max-w-[600px] mx-auto relative p-2 pt-20 overflow-hidden">
    <div id="animationContainer" class="absolute inset-0 pointer-events-none z-50 overflow-hidden"></div>
    <div class="flex justify-center items-start gap-2 sm:gap-4 w-full flex-grow relative pb-2 mt-2"> 
        <div class="flex flex-col w-[48%] max-w-[280px] gap-2 z-10">
            <div class="bg-white w-full rounded-2xl shadow-sm border border-orange-100 p-2 sm:p-3 text-center">
                <div id="playerNameDisplay" class="text-base sm:text-lg font-bold text-amber-700 leading-tight truncate">Spieler</div>
                <div class="text-[10px] sm:text-sm text-gray-500 mt-0.5">Karten: <span id="playerCards" class="font-bold text-xl sm:text-2xl text-gray-800">15</span></div>
            </div>
            <div class="w-full aspect-[20/46] perspective-1000 relative" id="playerCardContainer"><div id="playerCard" class="w-full h-full relative"></div></div>
        </div>
        <div class="flex flex-col w-[48%] max-w-[280px] gap-2 z-10">
            <div class="bg-white w-full rounded-2xl shadow-sm border border-orange-100 p-2 sm:p-3 text-center">
                <div id="opponentNameDisplay" class="text-base sm:text-lg font-bold text-gray-600 leading-tight truncate">COMPUTER</div>
                <div class="text-[10px] sm:text-sm text-gray-500 mt-0.5">Karten: <span id="aiCards" class="font-bold text-xl sm:text-2xl text-gray-800">15</span></div>
            </div>
            <div class="w-full aspect-[20/46] perspective-1000 relative" id="aiCardContainer"><div id="aiCard" class="w-full h-full relative"></div></div>
        </div>
    </div>
    <div class="w-full mt-4 mb-24"> 
        <div class="flex justify-between text-[9px] sm:text-[10px] font-bold text-gray-400 mb-1 px-1"><span>Dein Stapel</span><span>Gegenspieler</span></div>
        <div class="h-4 w-full bg-gray-200 rounded-full shadow-inner relative">
            <div id="statusBar" class="h-full bg-amber-500 rounded-l-full transition-all duration-500 ease-out" style="width: 50%;"></div>
            <div id="statusBall" class="absolute top-1/2 w-6 h-6 rounded-full border-2 border-white shadow-md transition-all duration-500 ease-out z-10" style="left: 50%; transform: translate(-50%, -50%); background: radial-gradient(circle at 30% 30%, #fbbf24, #d97706);"></div>
        </div>
    </div>
</div>

<div id="happyKlotzi" class="fixed bottom-64 right-2 z-[100] transition-transform duration-500 translate-y-full hidden pointer-events-none flex flex-col items-center">
    <div id="happyKlotziText" class="bg-white border-4 border-black text-black font-black text-base sm:text-lg px-4 py-2 rounded-2xl mb-1 shadow-[4px_4px_0px_rgba(0,0,0,0.2)] animate-bounce relative text-center">
        Stark!
        <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[12px] border-t-black"></div>
        <div class="absolute -bottom-[9px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[10px] border-t-white"></div>
    </div>
    <img src="https://github.com/aufdemholzweg/holzquartett/blob/main/images/klotzi_win.png?raw=true" alt="Jubel Klotzi" class="w-32 sm:w-40 filter drop-shadow-2xl">
</div>

<div id="tieOverlay" class="fixed inset-0 z-[90] flex items-center justify-center dimmer hidden pt-20">
    <div class="bg-white/10 backdrop-blur-md p-8 rounded-3xl animate-bounce-slam text-center border border-white/20 shadow-2xl relative">
        <img src="https://github.com/aufdemholzweg/holzquartett/blob/main/images/klotzi_quiz.png?raw=true" alt="Klotzi Quiz" class="w-32 mx-auto mb-2 object-contain filter drop-shadow-lg" onerror="this.style.display='none'">
        <div class="text-5xl mb-2 filter drop-shadow-lg">üí•</div>
        <h2 class="text-4xl sm:text-5xl font-black text-white uppercase tracking-wider drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)]">
            GLEICHSTAND!
        </h2>
        <p class="text-white font-bold text-lg mt-3 drop-shadow-md bg-black/20 px-4 py-1 rounded-full inline-block">Das Quiz entscheidet...</p>
    </div>
</div>

<div id="quizModal" class="fixed inset-0 dimmer flex items-center justify-center z-[80] p-4 hidden pt-20">
    <div class="bg-white rounded-2xl shadow-2xl relative w-full max-w-sm flex flex-col animate-pop-in border-4 border-amber-500 overflow-visible">
        
        <div class="h-4 w-full bg-gray-200 relative overflow-hidden rounded-t-xl">
            <div id="quizTimerBar" class="h-full w-0 bg-amber-500 rounded-r-sm relative"> 
                <div class="absolute right-0 top-1/2 w-4 h-4 bg-white border-2 border-amber-600 rounded-full shadow z-10 animate-pulse-dot transform translate-x-1/2 -translate-y-1/2"></div>
            </div>
        </div>
        
        <div class="p-6 text-center relative z-10">
            <div id="quizStatusText" class="inline-block bg-amber-100 text-amber-800 text-xs font-bold px-2 py-1 rounded-full mb-3 relative z-30">
                ‚ö†Ô∏è Gleichstand! Quiz l√§dt...
            </div>
            <h3 id="quizQuestion" class="text-lg font-bold text-gray-800 mb-6 leading-tight min-h-[3rem] flex items-center justify-center relative z-30 px-2">
                Frage wird geladen...
            </h3>
            <div id="quizOptions" class="grid grid-cols-1 gap-3 relative z-30">
            </div>
            
            <div id="quizExplanation" class="hidden mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-gray-700 leading-snug shadow-sm animate-pop-in">
            </div>
        </div>
    </div>
</div>

<div id="bottomSheetBackdrop" class="hidden fixed inset-0 bg-black/20 z-30 transition-opacity"></div>
<div id="bottomSheet" class="hidden fixed left-0 right-0 bottom-0 z-40 flex justify-center px-2 pb-6 transition-transform transform translate-y-full duration-300">
    <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-200 w-full max-w-md p-5 flex flex-col items-center">
        <div id="turnIndicator" class="text-xs sm:text-sm font-semibold text-gray-500 mb-1"></div>
        <h3 id="resultText" class="text-xl sm:text-2xl font-black uppercase tracking-wide mb-2 text-gray-800"></h3>
        <p id="resultDetails" class="text-xs sm:text-sm text-gray-600 mb-6 font-mono bg-gray-100 px-3 py-1 rounded-lg"></p>
        <div class="flex gap-3 w-full">
            <button id="bsInfoBtn" class="flex-1 bg-amber-600 hover:bg-amber-700 active:scale-95 text-white font-bold py-3 px-4 rounded-xl shadow-lg border-b-4 border-amber-800 transition text-sm sm:text-base">üéì Zusatzwissen</button>
            <button id="bsNextBtn" class="flex-1 bg-green-600 hover:bg-green-700 active:scale-95 text-white font-bold py-3 px-4 rounded-xl shadow-lg border-b-4 border-green-800 transition text-sm sm:text-base">Weiter &rarr;</button>
        </div>
    </div>
</div>

<div id="gameInfoModal" class="fixed inset-0 dimmer flex items-center justify-center z-[130] p-4 hidden pt-20">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-[400px] max-h-[85vh] flex flex-col">
        <div class="bg-amber-500 p-4 flex justify-between items-center text-white shrink-0 shadow-md">
            <h3 class="font-bold text-lg">Spielregeln & Eigenschaften</h3>
            <button onclick="window.closeGameInfo()" class="text-white/80 hover:text-white text-2xl leading-none">&times;</button>
        </div>
        <div class="p-5 overflow-y-auto hide-scrollbar">
            <h4 class="font-bold text-gray-700 text-md">Regeln</h4>
            <p class="text-sm text-gray-600 leading-relaxed mt-1 mb-4">Die aktive Person w√§hlt auf ihrer Karte die Eigenschaft, die den gr√∂√ütm√∂glichen Vorteil verspricht. Je nach Kategorie z√§hlt der h√∂here oder der niedrigere Wert (siehe die Beschreibung der Eigenschaften).</p>
            
            <p class="text-sm text-gray-600 leading-relaxed mb-6"><strong>Bei Gleichstand:</strong> Haben beide Karten den gleichen Wert, startet f√ºr BEIDE Spieler ein Quiz! Wer die Frage innerhalb von 10 Sekunden am schnellsten richtig beantwortet, gewinnt die Karte und ist als n√§chstes am Zug. Wird die Frage falsch beantwortet, gewinnt dein Gegenspieler. Wird die Frage von beiden Spielern innerhalb der Zeit NICHT beantwortet, bekommen beide keinen Punkt und jeder beh√§lt seine Karte.</p>
            
            <h4 class="font-bold text-gray-700 text-md mb-2">Beschreibung der Eigenschaften</h4>
            <div id="infoCategoryList" class="space-y-3"></div>
        </div>
    </div>
</div>

<div id="infoModal" class="fixed inset-0 dimmer flex items-center justify-center z-[160] p-4 hidden">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-md flex flex-col max-h-[80vh] mt-12">
        <div class="bg-amber-600 p-4 flex justify-between items-center text-white shrink-0">
            <h3 class="font-bold">Wissenskarte</h3>
            <button onclick="document.getElementById('infoModal').classList.add('hidden')" class="text-white/80 hover:text-white text-2xl leading-none">&times;</button>
        </div>
        <div id="infoModalContent" class="p-5 overflow-y-auto flex-grow"></div>
    </div>
</div>

<div id="imageViewerModal" class="fixed inset-0 z-[200] flex items-center justify-center dimmer hidden p-4" onclick="window.closeImageViewer()">
    <div class="relative max-w-full max-h-full">
        <button onclick="window.closeImageViewer()" class="absolute -top-12 right-0 text-white text-3xl font-bold hover:text-gray-300 pointer-events-auto">&times;</button>
        <img id="fullSizeImage" src="" class="max-h-[85vh] max-w-[95vw] rounded-lg shadow-2xl object-contain border-4 border-white" onclick="event.stopPropagation()">
    </div>
</div>

<div id="impressumModal" class="fixed inset-0 z-[140] flex items-center justify-center p-4 dimmer hidden pt-20">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-sm flex flex-col max-h-[85vh]">
        <div class="bg-slate-700 p-4 flex justify-between items-center text-white shrink-0">
            <h3 class="font-bold">Impressum</h3>
            <button onclick="document.getElementById('impressumModal').classList.add('hidden')" class="text-white/80 hover:text-white text-2xl leading-none">&times;</button>
        </div>
        <div class="p-6 overflow-y-auto text-sm text-gray-700 space-y-4">
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Angaben gem√§√ü ¬ß 5 DDG</h4>
                <p>Christopher Lehr<br>Waterloostra√üe 49<br>28201 Bremen</p>
            </div>
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Kontakt</h4>
                <p>E-Mail: christopher_lehr@web.de</p>
            </div>
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Kontext</h4>
                <p>Dieses interaktive Lernspiel entstand im Rahmen meiner Masterarbeit des Studiengang Lehramt an Berufsbildenden Schulen, Fachrichtung Holztechnik an der <strong>Leibniz Universit√§t Hannover</strong>. Es dient ausschlie√ülich nicht-kommerziellen Bildungs- und Forschungszwecken.</p>
            </div>
            
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Fachliche Grundlagen & Quellen</h4>
                <p class="text-xs text-gray-500 mb-1">Die verwendeten Holzdaten basieren auf folgenden Normen und Quellen:</p>
                <ul class="list-disc pl-4 text-xs text-gray-600 space-y-1">
                    <li><strong>DIN 68364:</strong> Kennwerte von Holzarten (Rohdichte, Elastizit√§tsmodul, Festigkeiten)</li>
                    <li><strong>DIN EN 338:</strong> Bauholz f√ºr tragende Zwecke ‚Äì Festigkeitsklassen</li>
                    <li><strong>DIN EN 350:</strong> Dauerhaftigkeitsklassen von Holz</li>
                    <li><strong>DIN 52184:</strong> Bestimmung der Quellung und Schwindung</li>
                    <li><strong>DIN 52192:</strong> Druckversuch quer zur Faserrichtung</li>
                    <li><strong>Vorlesung:</strong> Dr. Frank Peters (2021): Werkstoffkunde 1, Holzphysik</li>
                    <li><strong>Preise:</strong> <a href="https://www.muehlbauerholz.com/upload/schnittholz-mai-2024.pdf" target="_blank" class="underline text-blue-600">M√ºhlbauer Holz (Preisliste Mai 2024)</a></li>
                </ul>
            </div>

            <div>
                <h4 class="font-bold text-gray-900 mb-1">Haftung f√ºr Inhalte & Daten</h4>
                <p class="mb-2">Die Inhalte dieser Web-App wurden mit gr√∂√üter Sorgfalt und nach bestem Wissen und Gewissen erstellt. F√ºr die Richtigkeit, Vollst√§ndigkeit und Aktualit√§t der Inhalte kann jedoch keine Gew√§hr √ºbernommen werden.</p>
                <p class="mb-2"><strong>Besonderer Hinweis zu fachlichen Daten:</strong> Die im Spiel verwendeten Daten (z. B. Rohdichte, E-Modul, Preise) dienen prim√§r der Spielmechanik und der didaktischen Vereinfachung. Sie stellen Durchschnittswerte oder Richtwerte dar und ersetzen keine fachgerechte Planung nach DIN/EN-Normen.</p>
            </div>
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Haftung f√ºr Links</h4>
                <p>Diese Webseite enth√§lt Links zu externen Webseiten Dritter (z. B. GitHub), auf deren Inhalte ich keinen Einfluss habe. Deshalb kann ich f√ºr diese fremden Inhalte auch keine Gew√§hr √ºbernehmen. F√ºr die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder Betreiber der Seiten verantwortlich.</p>
            </div>



<div>
                <h4 class="font-bold text-gray-900 mb-1">Open Source & Lizenz (CC BY 4.0)</h4>
                
                <a href="https://github.com/aufdemholzweg/HOLZEN/blob/main/index.html" target="_blank" class="flex items-center justify-center gap-2 w-full bg-gray-800 hover:bg-gray-900 text-white p-3 rounded-lg mb-3 transition-colors no-underline group">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="font-bold text-sm">Quellcode auf GitHub ansehen</span>
                </a>
                <div class="flex flex-col gap-2 mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex items-center gap-3">
                        <img src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by.svg" alt="CC BY 4.0" class="w-24">
                        <span class="text-xs font-bold text-gray-700">Freie Nutzung erlaubt</span>
                    </div>
                    <div class="text-xs text-gray-600 mt-1">
                        <p class="mb-2">
                            <strong>Soweit nicht anders gekennzeichnet</strong>, stehen der Programmcode, das Spielkonzept, die Quizfragen und eigene Texte dieses Projekts unter der 
                            <a href="https://creativecommons.org/licenses/by/4.0/deed.de" target="_blank" class="underline text-blue-600">Creative Commons Namensnennung 4.0 International Lizenz (CC BY 4.0)</a>.
</p>
                        <p><strong>Das bedeutet:</strong> Sie d√ºrfen das Material teilen und bearbeiten (auch f√ºr kommerzielle Zwecke), solange Sie den Urheber wie folgt nennen:</p>
                        <div class="bg-white p-2 border border-gray-300 rounded mt-1 font-mono text-[10px] text-gray-500 select-all">
                             "HOLZEN" von Christopher Lehr, Quellcode verf√ºgbar auf GitHub, lizenziert unter CC BY 4.0.
</div>
                    </div>
                </div>

                <p class="mb-1 font-bold text-xs text-red-700">‚ö†Ô∏è Wichtiger Hinweis zu Drittinhalten:</p>
                <p class="text-xs text-gray-600 mb-2">
                    Von dieser freien Lizenzierung ausdr√ºcklich <strong>ausgenommen</strong> sind eingebundene Medien Dritter im Repository. Diese verbleiben unter ihrem urspr√ºnglichen Urheberrecht.
Dies betrifft:
                </p>
                <ul class="list-disc pl-4 text-xs text-gray-600 space-y-1 mb-2">
                    <li>Die <strong>Holzbilder</strong> (im Ordner <code>/images</code>).
Rechte liegen bei <em>holzvomfach.de</em> und <em>schreiner-seiten.de</em>.</li>
                    <li>Die <strong>Sounds</strong> (im Ordner <code>/sounds</code>).
Genutzt unter der Freesound License.</li>
                    <li>Markennamen und Normen (DIN).</li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Bild- und Tonquellen</h4>
                <ul class="list-disc pl-4 text-xs text-gray-600 space-y-1">
                    <li><strong>Holzbilder:</strong> <a href="https://holzvomfach.de/" target="_blank" class="underline text-blue-600">holzvomfach.de</a> , <a href="https://www.schreiner-seiten.de/index.php" target="_blank" class="underline text-blue-600">schreiner-seiten.de</a></li>
                    <li><strong>Sounds:</strong> <a href="https://freesound.org/" target="_blank" class="underline text-blue-600">free.sound.org</a></li>
                    <li><strong>Emojis/Icons:</strong> Systemstandard (Unicode)</li>
                </ul>
            </div>
            
            <hr class="my-4 border-gray-300">
            
            <div>
                <h4 class="font-bold text-gray-900 mb-1">Datenschutz & Technik</h4>
                <p class="mb-2">Da dies ein reines Forschungsprojekt ist, werden so wenige Daten wie m√∂glich gespeichert.
Dennoch kommen externe Dienstleister zum Einsatz, um die technische Funktion zu gew√§hrleisten:</p>
                
                <ul class="list-disc pl-4 text-xs text-gray-600 space-y-2">
                    <li>
                        <strong>Hosting (GitHub Pages):</strong><br>
                        Diese Webseite wird auf Servern von GitHub Inc. (USA) gehostet.
Beim Aufruf der Seite werden technisch bedingt Verbindungsdaten (z. B. IP-Adresse) an GitHub √ºbertragen, um die Inhalte auszuliefern.
</li>
                    <li>
                        <strong>Datenbank & Backend (Google Firebase):</strong><br>
                        F√ºr die Multiplayer-Funktion (Spielst√§nde, Synchronisation) nutze ich Google Firebase (Google Ireland Limited).
Die Spieldaten werden tempor√§r auf deren Servern gespeichert. Ich verwenden hier die "Anonyme Anmeldung", sodass keine Klarnamen oder E-Mail-Adressen von Nutzern gespeichert werden.
</li>
                    <li>
                        <strong>Cookies / LocalStorage:</strong><br>
                        Das Spiel speichert lediglich technische Einstellungen (z. B. Sound an/aus) lokal auf Ihrem Ger√§t ("LocalStorage").
Es werden keine Tracking oder Werbe-Cookies eingesetzt.
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div id="attrConfigModal" class="fixed inset-0 z-[120] flex items-center justify-center p-4 dimmer hidden pt-20">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-sm flex flex-col max-h-[85vh]">
        <div class="bg-amber-600 p-4 flex justify-between items-center text-white shrink-0">
            <h3 class="font-bold">Spieloptionen</h3>
            <button onclick="window.closeAttrConfig()" class="text-white/80 hover:text-white text-2xl leading-none">&times;</button>
        </div>
        <div class="p-4 overflow-y-auto">
            <div class="mb-5 space-y-3">
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-100">
                     <span class="font-bold text-gray-700 text-sm flex items-center gap-2">üîä Ton an</span>
                     <input type="checkbox" id="soundToggle" class="accent-green-500 w-5 h-5">
                </div>
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-100">
                     <span class="font-bold text-gray-700 text-sm flex items-center gap-2">üëÄ Gegner-Karte sichtbar</span>
                      <input type="checkbox" id="revealBackToggle" class="accent-green-500 w-5 h-5">
                </div>
            </div>
            <hr class="border-gray-200 mb-4 border-t-2 border-dashed">
            <h4 class="font-bold text-gray-800 mb-1 text-sm">Eigenschaften w√§hlen</h4>
            <p class="text-xs text-gray-500 mb-3">W√§hle mindestens 3 und maximal 5 Kategorien.</p>
            <div id="attrConfigList" class="space-y-2"></div>
        </div>
        <div class="p-4 bg-gray-50 border-t">
             <button onclick="window.closeAttrConfig()" class="w-full bg-amber-500 text-white font-bold py-2 rounded-lg shadow">Fertig</button>
        </div>
    </div>
</div>

<div id="setupModal" class="fixed inset-0 z-[110] flex flex-col items-center justify-center p-4 dimmer overflow-y-auto h-screen">
    <div class="w-10 h-10 absolute left-4 top-4"></div>
    
    <div class="relative w-full max-w-sm pt-20">
        <a href="https://forms.office.com/r/dPiXWjBiGQ" target="_blank" 
           class="absolute top-4 left-0 z-[120] bg-violet-600 hover:bg-violet-700 text-white text-xs font-bold h-16 flex items-center justify-center px-4 rounded-full shadow-lg transition-transform active:scale-95 gap-2 no-underline border-2 border-white/20 w-48">
            <span>üí¨</span> Feedback zum Spiel
        </a>

        <img src="https://github.com/aufdemholzweg/holzen/blob/main/images/klotzi_menu.png?raw=true" alt="Klotzi Men√º" class="absolute -top-4 -right-2 w-48 z-20 pointer-events-none transform rotate-3 drop-shadow-xl" onerror="this.style.display='none'">
        
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full relative mb-6 z-10">
            <div class="bg-amber-50 p-5 text-white text-center font-bold text-lg sm:text-xl tracking-wide shadow-md" style="background-color: #f59e0b;">HOLZEN!<br><span class="text-sm font-normal opacity-90">Spielmodus w√§hlen</span></div>
            <div class="p-6 space-y-4">
                <button onclick="window.showNamePrompt('ai')" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-3 active:scale-95 transition-transform"><span class="text-2xl">ü§ñ</span> Gegen Computer</button>
                <button onclick="window.showNamePrompt('multiplayer')" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-3 active:scale-95 transition-transform"><span class="text-2xl">üåç</span> Online gegen Freunde</button>
                
                <div class="flex gap-3 mt-2">
                    <button onclick="window.openAttrConfig()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-sm">
                         <span>‚öôÔ∏è</span> Optionen <span id="attrCountBadge" class="bg-amber-500 text-white text-[10px] px-1.5 py-0.5 rounded-full">5</span>
                    </button>
                    <button onclick="window.showLeaderboard(true)" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-sm">
                        <span>üèÜ</span> Rangliste
                    </button>
                </div>
            </div>
        </div>
        
        <div id="mainMenuStats" class="text-center hidden mb-8 relative z-10"></div>
        
        <div class="mt-auto pt-4 pb-12 text-center relative z-10">
           <button onclick="document.getElementById('impressumModal').classList.remove('hidden')" class="text-white/70 text-xs font-medium hover:text-white underline transition-colors">Impressum</button>
        </div>
    </div>
</div>

<div id="nameModal" class="hidden fixed inset-0 dimmer flex items-center justify-center z-50 p-4 pt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-xs w-full text-center relative overflow-visible">
        
        <img src="https://github.com/aufdemholzweg/holzen/blob/main/images/klotzi_name.png?raw=true" alt="Klotzi Name" class="absolute -top-24 left-1/2 -translate-x-1/2 w-48 pointer-events-none drop-shadow-xl z-20" onerror="this.style.display='none'">
        
        <div class="relative z-10 mt-16"> 
            <h2 class="text-xl font-bold text-gray-800 mb-6">Dein Name</h2>
            <input type="text" id="playerName" class="w-full p-3 border-2 border-gray-200 rounded-lg mb-6 text-center font-bold text-lg" placeholder="Name eingeben" maxlength="12">
            <button id="nameSubmitButton" class="w-full bg-amber-500 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-amber-600">Starten</button>
        </div>
    </div>
</div>

<div id="multiplayerLobbyModal" class="hidden fixed inset-0 dimmer flex items-center justify-center z-50 p-4 pt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center">
        <h2 id="lobbyTitle" class="text-xl font-bold text-amber-800 mb-2">Lobby</h2>
        <p id="lobbyText" class="text-sm text-gray-600 mb-4">Lass deinen Freund scannen:</p>
        <div class="flex justify-center mb-4"><div id="qrcode" class="p-2 bg-white rounded-lg border border-gray-200"></div></div>
        <div class="bg-gray-100 p-2 rounded mb-4 flex items-center gap-2">
            <input id="shareLink" type="text" class="bg-transparent text-xs w-full text-gray-600 font-mono" readonly>
            <button onclick="window.copyShareLink()" class="bg-white px-3 py-1 rounded text-xs font-bold border shadow-sm hover:bg-gray-50">Kopieren</button>
        </div>
        <p class="text-sm text-green-600 font-bold animate-pulse">Warte auf Mitspieler...</p>
    </div>
</div>

<div id="gameOverModal" class="hidden fixed inset-0 dimmer flex items-center justify-center z-50 p-4 pt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center relative overflow-visible">
        
        <style>
            .scene-stage { width: 100%; height: 220px; position: relative; background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 70%, #8D6E63 70%, #5D4037 100%); border-radius: 16px; overflow: hidden; border: 4px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.15); margin-bottom: 20px; }
            .klotzi-real { height: 100px; width: auto; position: absolute; bottom: 50px; left: 40px; z-index: 10; transform-origin: bottom center; animation: klotzi-logic 6s infinite ease-in-out; }
            .seed { font-size: 20px; position: absolute; bottom: 120px; left: 160px; opacity: 0; animation: seed-fall 6s infinite; }
            .big-tree { font-size: 120px; position: absolute; bottom: 35px; left: 110px; transform-origin: bottom center; transform: scale(0); filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.2)); animation: tree-pop 6s infinite; }
            .sun-ray { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: repeating-conic-gradient(from 0deg, rgba(255,255,255,0.4) 0deg 10deg, transparent 10deg 20deg); animation: spin-sun 20s linear infinite; z-index: 0; }
            
            /* NEUE LOGIK F√úR VERLIERER-SZENARIO */
            .scene-stage.lose-state .sun-ray { display: none; }
            .scene-stage.lose-state .big-tree { display: none; }
            .scene-stage.lose-state .seed { animation: none; opacity: 1; transform: translateY(70px) scale(0.8); left: 140px; }
            .scene-stage.lose-state .klotzi-real { animation: none; bottom: 50px; left: 180px; transform: scale(0.9); }

            @keyframes klotzi-logic { 0% { transform: translateX(-100px); } 10% { transform: translateX(0); } 15% { transform: scaleY(0.9); } 20% { transform: scaleY(1); } 40% { transform: translateX(0); } 45% { transform: translateY(-20px) rotate(-10deg); } 50% { transform: translateY(0) rotate(0deg); } 55% { transform: translateY(-20px) rotate(10deg); } 60% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(0); } }
            @keyframes seed-fall { 0%, 10% { opacity: 0; transform: translateY(0); } 15% { opacity: 1; transform: translateY(0); } 25% { opacity: 1; transform: translateY(70px) scale(0.5); } 26%, 100% { opacity: 0; } }
            @keyframes tree-pop { 0%, 25% { transform: scale(0); } 35% { transform: scale(1.2); } 40% { transform: scale(0.9); } 45% { transform: scale(1); } 100% { transform: scale(1); } }
            @keyframes spin-sun { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        </style>

        <div class="scene-stage" role="img" aria-label="Animation: Klotzi pflanzt einen Baum">
            <div class="sun-ray"></div>
            <img src="https://github.com/aufdemholzweg/holzen/blob/main/images/klotzi_win.png?raw=true" class="klotzi-real" alt="Klotzi">
            <div class="seed">üå∞</div>
            <div class="big-tree">üå≥</div>
        </div>
        
        <div class="relative z-10 mt-4"> 
            <h2 id="gameOverTitle" class="text-3xl font-black mb-2 text-gray-800">SPIELENDE</h2>
            <p id="gameOverText" class="text-gray-600 mb-6"></p>

            <div id="gameOverFeedbackContainer" class="hidden mb-2 animate-pop-in">
                 <a href="https://forms.office.com/r/dPiXWjBiGQ" target="_blank" 
                    class="block w-full bg-violet-600 hover:bg-violet-700 text-white font-bold py-2.5 rounded-xl shadow-lg text-center border-2 border-white/20 transition-transform active:scale-95">
                    üí¨ Feedback geben
                 </a>
            </div>

            <div class="space-y-3">
                <button onclick="window.showLeaderboard(false)" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-2 rounded-lg border border-gray-300">üèÜ Bestenliste</button>
                <button onclick="window.resetGame()" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 rounded-lg shadow">üîÑ Neues Spiel</button>
            </div>
        </div>
    </div>
</div>

<div id="reflectionModal" class="hidden fixed inset-0 dimmer flex items-center justify-center z-50 p-4 pt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full">
        <h2 class="text-xl font-bold text-amber-800 mb-4">üéâ Super gespielt!</h2>
        <p id="reflectionQuestion" class="text-gray-700 mb-4 font-medium"></p>
        <textarea id="reflectionAnswer" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 min-h-[100px] mb-4 text-sm" placeholder="Deine Gedanken dazu..."></textarea>
        <button onclick="window.showFinalWinScreen()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 rounded-lg shadow-lg">Weiter</button>
    </div>
</div>

<div id="leaderboardModal" class="hidden fixed inset-0 dimmer flex items-center justify-center z-[150] p-4 pt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full flex flex-col max-h-[80vh]">
        <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">üèÜ Bestenliste</h2>
        <div id="leaderboardList" class="overflow-y-auto flex-grow space-y-2 mb-4"></div>
        <button onclick="window.closeLeaderboard()" class="w-full bg-gray-200 hover:bg-gray-300 font-bold py-2 rounded-lg text-gray-700">Schlie√üen</button>
    </div>
</div>

<script type="module">
// 4. DATENBANK & LOGIK (JAVASCRIPT)
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, serverTimestamp, deleteDoc, collection, query, orderBy, limit, getDocs, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyCyRXl8-JPr1xTXPDi1VG-eQk6fOnTpqUI",
  authDomain: "holzen-3a177.firebaseapp.com",
  projectId: "holzen-3a177",
  storageBucket: "holzen-3a177.appspot.com",
  messagingSenderId: "1081595025073",
  appId: "1:1081595025073:web:bc571fffb6e4f20b27f490",
  measurementId: "G-HKLWFJE83K"
};
const activeConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
const appId = typeof __app_id !== 'undefined' ? __app_id : 'holzen-3a177';

let app, db, auth;
try {
    app = initializeApp(activeConfig);
    db = getFirestore(app);
    auth = getAuth(app);
} catch (e) {
    console.error("Firebase Init Error:", e);
    alert("Fehler beim Laden der Datenbank-Konfiguration.");
}

const initAuth = async () => {
    try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
    } catch (e) {
        console.error("Auth Failed", e);
    }
};
initAuth();
const getPublicDataRef = (coll, docId) => {
    if(docId) return doc(db, 'artifacts', appId, 'public', 'data', coll, docId);
    return collection(db, 'artifacts', appId, 'public', 'data', coll);
};

// -------------------------------------------------------------
// WAKE LOCK (BILDSCHIRM WACH HALTEN)
// -------------------------------------------------------------
let wakeLock = null;
async function requestWakeLock() {
    if ('wakeLock' in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
            console.log('Wake Lock aktiv');
        } catch (err) {
            console.log(`${err.name}, ${err.message}`);
        }
    }
}

async function trackEvent(type) {
    if (!auth || !auth.currentUser) return;
    const ref = getPublicDataRef("statistics", "usage"); 
    try {
        await setDoc(ref, {
            [type]: increment(1),
            last_activity: serverTimestamp()
        }, { merge: true });
    } catch (e) {
        console.warn("Tracking eingeschr√§nkt.", e);
    }
}

// -------------------------------------------------------------
// NAV ICONS UND FUNKTIONALIT√ÑT
// -------------------------------------------------------------
const NAV_ICONS = {
    fingerprint: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 22c0-8 3-14 8-20" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.9" />
                    <path d="M2 16c2-4 4-8 5-14" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.6" />
                    <path d="M8 22c1-6 2-10 6-12 3-1.5 6 0 8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.8" />
                    <path d="M13 22c1-4 3-8 7-8" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.7" />
                    <path d="M18 22c1-3 2-6 4-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.5" />
                    <path d="M16 2c2 1 4 4 6 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.6" />
                  </svg>`,
    house: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>`
};
function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

window.setNavState = (state) => {
    const btn = document.getElementById('navButton');
    if(!btn) return;
    // REMOVE OLD HANDLERS (Clean Navigation)
    btn.onclick = null;
    if(state === 'game') {
        btn.innerHTML = NAV_ICONS.house;
        btn.removeAttribute('href');
        btn.onclick = (e) => { 
            e.preventDefault();
            if(confirm('Spiel abbrechen und zum Startbildschirm zur√ºckkehren?')) { 
                if(typeof unsubscribeGame === 'function') unsubscribeGame();
                if(wakeLock) wakeLock.release();
                window.location.href = "https://aufdemholzweg.github.io/HOLZEN/"; 
            } 
        };
        btn.setAttribute('aria-label', 'Zur√ºck zur Holzen! Startseite');
    } else if (state === 'name_input') {
        btn.innerHTML = NAV_ICONS.house;
        btn.href = "#";
        btn.onclick = (e) => {
            e.preventDefault();
            document.getElementById('nameModal').classList.add('hidden');
            document.getElementById('setupModal').classList.remove('hidden');
            window.setNavState('menu');
        };
        btn.setAttribute('aria-label', 'Zur√ºck zum Hauptmen√º');
        
    } else {
        // Default: Link zum Splashscreen
        btn.innerHTML = NAV_ICONS.fingerprint;
        btn.href = 'https://aufdemholzweg.github.io/Lernwelt-Holz/';
        btn.onclick = null; 
        btn.setAttribute('aria-label', 'Zum Splashscreen');
    }
};

// Initial Call
window.setNavState('menu');
let gameMode=null, gameId=null, localPlayerId=null, unsubscribeGame=null, localGameState={}, winStreak=0, hasCopiedShareLink=false;
let isMuted=false;
let roundSoundPlayed=false;
let lastRoundWinningWoodName = null;
let aiGame={playerName:'',playerCards:[],aiCards:[],currentPlayerCard:null,currentAiCard:null,roundInProgress:false,turn:'player'};
// --- RUN LOGIK ---
function checkRun() {
    if (winStreak === 5) {
        const overlay = document.getElementById('runOverlay');
        overlay.classList.remove('hidden');
        setTimeout(() => overlay.classList.add('hidden'), 2500);
    }
}

// 5. ATTRIBUTE & EIGENSCHAFTEN (Updated)
const attributeInfo={
druckfestigkeit:{
     icon:'üóú',
     name:'Druckfestigkeit',
     unit:'(N/mm¬≤)', 
     logic: 'Hoch gewinnt', 
     default: true,
     description: `Die Druckfestigkeit (N/mm¬≤) beschreibt, mit wie viel Druck das Holz in Faserrichtung belastet werden kann, bevor es zum Bruch kommt.`
 },
rohdichte:{
     icon:'üíé',
     name:'Rohdichte',
     unit:'(kg/m¬≥)', 
     logic: 'Hoch gewinnt', 
     default: true,
     description: 'Die Normal-Rohdichte beschreibt das Gewicht des Holzes in kg/m¬≥. Er bezieht sich auf das Normalklima bei ca. 12 % Holzfeuchtte (DIN 68364). Sie korreliert oft mit der Festigkeit von H√∂lzern.'
},
 emodul:{
     icon:'„Ä∞Ô∏è',
     name:'E-Modul',
     unit:'(N/mm¬≤)', 
     logic: 'Hoch gewinnt', 
     default: true,
     description: 'Der E-Modul (Elastizit√§tsmodul) beschreibt die Steifigkeit des Holzes nach DIN EN 338 (in N/mm¬≤). Er zeigt an, wie stark sich das Holz unter Kraftaufwand elastisch verformt. H√∂lzer mit hohem E-Modul sind steifer und bleiben unter Last formstabiler, solange die Belastung im elastischen Bereich bleibt und keine bleibende Verformung entsteht.'
},
dk:{
     icon:'üõ°Ô∏è',
     name:'Dauerhaftigkeit',
     unit:'(DK)', 
     logic: 'Niedrig gewinnt', 
     default: true,
     description: 'Die Dauerhaftigkeit nach DIN EN 350 gibt an, wie resistent das Kernholz gegen biologischen Befall ist: DK 1 bedeutet eine sehr lange Wiederstandsf√§higkeit gegen√ºber Pilze, Insekten und andere Sch√§dlinge, DK 5 dagegen eine sehr geringe Dauerhaftigkeit.'
},
 quellen:{
     icon:'‚ÜîÔ∏è',
     name:'Quellen/Schw.',
     unit:'(%)', 
     logic: 'Niedrig gewinnt', 
     default: true,
     description: 'Angegeben ist das mittlere Schwindma√ü (%). Dieser Wert beschreibt die durchschnittliche Ma√ü√§nderung quer zur Faser vom faserges√§ttigten Zustand (ca. 30 % Holzfeuchte) bis zum darrtrockenen Zustand (0 %).'
},
 preis:{
     icon:'üí∞',
     name:'Materialkosten',
     unit:'(Preisgruppe)', 
     logic: 'Niedrig gewinnt', 
     default: true,
     description: `Die Materialkosten sind ein entscheidender Faktor f√ºr die Wirtschaftlichkeit eines Holzes.
Gruppe 1 bedeutet, es ist sehr g√ºnstig, Gruppe 5 bedeuten sehr hohe Kosten (‚Ç¨/m¬≥).
Gruppe 1: 0 ‚Ç¨ bis 699 ‚Ç¨; Gruppe 2: 700 ‚Ç¨ bis 1199 ‚Ç¨;
Gruppe 3:   1200 ‚Ç¨ bis 1999 ‚Ç¨; Gruppe 4:   2000 ‚Ç¨ bis 3999 ‚Ç¨;
Gruppe 5: mehr als 4000 ‚Ç¨`
 }
};
// RANDOM DEFAULT ATTRIBUTES
function getRandomDefaultAttributes() {
    const keys = Object.keys(attributeInfo);
    // Simple shuffle
    for (let i = keys.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [keys[i], keys[j]] = [keys[j], keys[i]];
    }
    return keys.slice(0, 5);
}

let activeAttributeKeys = getRandomDefaultAttributes();
const sounds={
 flip:new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_139083c224.mp3'),
 win:new Audio('https://github.com/aufdemholzweg/holzen/blob/64126fed45ff8c3fb4bd833f473d83f51ba0548b/Sounds/spielzuggewonnen.mp3?raw=true'),
 quizTick: new Audio('https://github.com/aufdemholzweg/holzen/blob/c491fcce7b6340c1b7cf0852321134012a156131/Sounds/ticken_bei_quizfrage.mp3?raw=true'),
 tieAlert: new Audio('https://github.com/aufdemholzweg/holzen/blob/main/Sounds/Quiztime.mp3?raw=true'),
 gameWin: new Audio('https://github.com/aufdemholzweg/holzen/blob/main/Sounds/win%20game.mp3?raw=true')
};
function playSound(a){ if(!isMuted && a){ a.currentTime=0; a.play().catch(()=>{}); } }

function isOpponentNameBackVisible(){ return localStorage.getItem('holzen_showOpponentNameOnBack')==='true'; }
function setOpponentNameBackVisible(v){ localStorage.setItem('holzen_showOpponentNameOnBack', v?'true':'false'); }

const IMG_BASE = "https://github.com/aufdemholzweg/holzen/blob/main/images";
const IMG_SUFFIX = "?raw=true";

// 6. KARTEN DATEN
const woodCards=[
 {name:"Ahorn", dk:"5", druckfestigkeit:60, quellen:6, rohdichte:650, emodul:9500, preis:2, imgTree:`${IMG_BASE}/ahorn_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/ahorn_2.jpeg${IMG_SUFFIX}`},
 {name:"Birke", dk:"5", druckfestigkeit:60, quellen:8, rohdichte:650, emodul:14500, preis:2, imgTree:`${IMG_BASE}/birke_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/birke_2.jpeg${IMG_SUFFIX}`},
 {name:"Douglasie", dk:"5", druckfestigkeit:60, quellen:6, rohdichte:500, emodul:13000, preis:4, imgTree:`${IMG_BASE}/douglasie_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/douglasie_2.jpeg${IMG_SUFFIX}`},
 {name:"Ebenholz, Afr.", dk:"1-2", druckfestigkeit:80, quellen:11, rohdichte:1200, emodul:13000, preis:5, imgTree:`${IMG_BASE}/ebenholz_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/ebenholz_2.jpeg${IMG_SUFFIX}`},
 {name:"Edelkastanie", dk:"2", druckfestigkeit:60, quellen:5, rohdichte:620, emodul:9000, preis:3, imgTree:`${IMG_BASE}/kastanie_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/kastanie_2.jpeg${IMG_SUFFIX}`},
 {name:"Eibe", dk:"2", druckfestigkeit:60, quellen:5, rohdichte:670, emodul:15000, preis:4, imgTree:`${IMG_BASE}/eibe_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/eibe_2.jpeg${IMG_SUFFIX}`},
 {name:"Eiche", dk:"2", druckfestigkeit:40, quellen:10, rohdichte:670, emodul:13000, preis:3, imgTree:`${IMG_BASE}/eiche_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/eiche_2.jpeg${IMG_SUFFIX}`},
 {name:"Erle", dk:"5", druckfestigkeit:60, quellen:7, rohdichte:550, emodul:9500, preis:1, imgTree:`${IMG_BASE}/erle_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/erle_2.jpeg${IMG_SUFFIX}`},
 {name:"Esche", dk:"5", druckfestigkeit:60, quellen:7, rohdichte:670, emodul:13000, preis:2, imgTree:`${IMG_BASE}/esche_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/esche_2.jpeg${IMG_SUFFIX}`},
 {name:"Fichte", dk:"4", druckfestigkeit:60, quellen:6, rohdichte:480, emodul:11000, preis:2, imgTree:`${IMG_BASE}/fichte_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/fichte_2.jpeg${IMG_SUFFIX}`},
 {name:"Hemlock", dk:"4", druckfestigkeit:60, quellen:7, rohdichte:480, emodul:10000, preis:4, imgTree:`${IMG_BASE}/hemlock_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/hemlock_2.jpeg${IMG_SUFFIX}`},
 {name:"Hickory", dk:"4", druckfestigkeit:60, quellen:9, rohdichte:800, emodul:15000, preis:3, imgTree:`${IMG_BASE}/hickory_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/hickory_2.jpeg${IMG_SUFFIX}`},
 {name:"Kiefer", dk:"3-4", druckfestigkeit:60, quellen:8, rohdichte:520, emodul:11000, preis:1, imgTree:`${IMG_BASE}/kiefer_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/kiefer_2.jpeg${IMG_SUFFIX}`},
 {name:"L√§rche", dk:"3-4", druckfestigkeit:60, quellen:7, rohdichte:590, emodul:13800, preis:3, imgTree:`${IMG_BASE}/laerche_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/laerche_2.jpeg${IMG_SUFFIX}`},
 {name:"Linde", dk:"5", druckfestigkeit:60, quellen:10.8, rohdichte:520, emodul:7200, preis:2, imgTree:`${IMG_BASE}/linde_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/linde_2.jpeg${IMG_SUFFIX}`},
 {name:"Mahagoni (echtes)", dk:"2", druckfestigkeit:60, quellen:5, rohdichte:600, emodul:10600, preis:5, imgTree:`${IMG_BASE}/mahagoni_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/mahagoni_2.jpeg${IMG_SUFFIX}`},
 {name:"Meranti (DR)", dk:"3-4", druckfestigkeit:60, quellen:7, rohdichte:720, emodul:14500, preis:4, imgTree:`${IMG_BASE}/meranti_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/meranti_2.jpeg${IMG_SUFFIX}`},
 {name:"Nussbaum (EU)", dk:"3", druckfestigkeit:80, quellen:6, rohdichte:670, emodul:12000, preis:4, imgTree:`${IMG_BASE}/nuss_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/nuss_2.jpeg${IMG_SUFFIX}`},
 {name:"Palisander", dk:"1", druckfestigkeit:80, quellen:6, rohdichte:850, emodul:12800, preis:5, imgTree:`${IMG_BASE}/palisander_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/palisander_2.jpeg${IMG_SUFFIX}`},
 {name:"Pappel", dk:"5", druckfestigkeit:40, quellen:7, rohdichte:450, emodul:9000, preis:2, imgTree:`${IMG_BASE}/pappel_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/pappel_2.jpeg${IMG_SUFFIX}`},
 {name:"Platane", dk:"5", druckfestigkeit:40, quellen:7, rohdichte:620, emodul:12800, preis:3, imgTree:`${IMG_BASE}/platane_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/platane_2.jpeg${IMG_SUFFIX}`},
 {name:"Redwood", dk:"2", druckfestigkeit:40, quellen:4, rohdichte:420, emodul:9500, preis:4, imgTree:`${IMG_BASE}/redwood_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/redwood_2.jpeg${IMG_SUFFIX}`},
 {name:"Robinie", dk:"1-2", druckfestigkeit:80, quellen:6, rohdichte:770, emodul:13600, preis:3, imgTree:`${IMG_BASE}/robinie_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/robinie_2.jpeg${IMG_SUFFIX}`},
 {name:"Rotbuche", dk:"5", druckfestigkeit:60, quellen:9, rohdichte:720, emodul:14000, preis:2, imgTree:`${IMG_BASE}/buche_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/buche_2.jpeg${IMG_SUFFIX}`},
 {name:"R√ºster", dk:"4", druckfestigkeit:40, quellen:7, rohdichte:670, emodul:11000, preis:3, imgTree:`${IMG_BASE}/ulme_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/ulme_2.jpeg${IMG_SUFFIX}`},
 {name:"Tanne", dk:"4", druckfestigkeit:40, quellen:6, rohdichte:450, emodul:11000, preis:2, imgTree:`${IMG_BASE}/tanne_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/tanne_2.jpeg${IMG_SUFFIX}`},
 {name:"Teak", dk:"1", druckfestigkeit:60, quellen:7, rohdichte:670, emodul:13000, preis:5, imgTree:`${IMG_BASE}/teak_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/teak_2.jpeg${IMG_SUFFIX}`},
 {name:"Weng√©", dk:"2", druckfestigkeit:100, quellen:7, rohdichte:850, emodul:16000, preis:4, imgTree:`${IMG_BASE}/wenge_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/wenge_2.jpeg${IMG_SUFFIX}`},
 {name:"Zebrano", dk:"2-3", druckfestigkeit:60, quellen:7, rohdichte:770, emodul:15400, preis:4, imgTree:`${IMG_BASE}/zebrano_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/zebrano_2.jpeg${IMG_SUFFIX}`},
 {name:"Zeder", dk:"1-2", druckfestigkeit:40, quellen:7, rohdichte:550, emodul:7200, preis:5, imgTree:`${IMG_BASE}/zeder_1.jpeg${IMG_SUFFIX}`, imgCross:`${IMG_BASE}/zeder_2.jpeg${IMG_SUFFIX}`}
];
